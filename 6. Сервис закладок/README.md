# Домашнее задание к 5 лекции

В данном задании вам предлагается проверить работоспособность бэкенда для веб-сервиса сохранения закладок.
Необходимо написать unit- и интеграционные тесты на данный код, а также исправить баги, найденные в процессе тестирования.


## Задание

Изучите код приложения и напишите _**модульные**_ и _**интеграционные**_ (API) тесты на все опубликованные эндпоинты.

Необходимо добиться покрытия кода тестами минимум на 70% (данный порог фигурирует в CI). 
Вас не ограничивают в выборе дополнительных инструментов для тестирования: вы можете использовать как инструменты из лекции, так и брать неупомянутые в ней библиотеки.

При написании кода тестов, старайтесь чтобы он был лаконичен. Пишите вспомогательные классы для этого, если потребуется.

Обязательные требования:
1. Форкните (fork) репозиторий и создайте отдельную ветку (branch) в нем.
2. Добавьте в папку `tests` в корне проекта необходимые тесты с использованием библиотеки [pytest](https://docs.pytest.org/en/7.1.x/):
   - информацию о том, как следует называть тесты можно найти в `pyproject.toml`;
   - папка и файл `conftext.py` уже добавлены за вас;
3. Напишите модульные тесты, как минимум на проверку работы бизнес-логики, связанной с пользователям;
4. Напишите интеграционные тесты на все HTTP API, имеющиеся в проекте;
5. Используйте модуль `Mock` для исключения работы `get_page_title` в некоторых тестовых сценариях;
6. При обнаружении ошибок, зафиксируйте их в отчете о тестировании (заведите issue в своем репозитории, укажите критичность - см. [bug-severity](https://www.software-testing.by/blog/bug-severity/).
7. Исправьте обнаруженные ошибки и добейтесь "зеленых" тестов
8. Добейтесь запуска команды `make lint` без вывода ошибок (будет проверено в CI)

## Описание функциональности приложения

Swagger с подробным описанием контрактов ручек доступен после поднятия приложения по адресу `http://127.0.0.1:8000/swagger`

Приду краткое описание функциональности:

1) Регистрация пользователя (по логину и паролю)
2) Аутентификация пользователя по логину и паролю с выдачей JWT
3) Создание закладки с указанием URL страницы
   - при сохранении закладки производится считывание заголовка страницы и сохранение закладки вместе с заголовком
   - при сохранении закладки есть возможность назначить тэг

4) Просмотр закладок
    - просмотр всех закладок
    - просмотр одной конкретной закладки
    - просмотр всех закладок под определенным тэгом
    - задание порядка отображения закладок по:
      - заголовку страницы
      - URL страницы
      - дате добавления
5) Удаление закладки
6) Удаление аккаунта

## Работа с приложением

### Требования

Необходимо, чтобы были установлены следующие компоненты:

- `Docker` и `docker-compose`
- `Python 3.10`
- `Poetry`

### Установка

1. Создание виртуального окружения и установка зависимостей:
```commandline
poetry install
```

2. Активация виртуального окружения:

```commandline
poetry shell
```


### Запуск

0. Создание `.env` файла с необходимыми переменными:
```commandline
make env
```

1. Создание базы в docker-контейнере (чтобы не работать с локальной базой):
```commandline
make db
```
2. Выполнение миграций:
```commandline
make migrate head
```
3. Запуск приложения:
```commandline
make run
```

### Тестирование

- Запуск тестов со всеми необходимыми флагами:
```commandline
make test
```

- Запуск тестов с генерацией отчета о покрытии:
```commandline
make test-cov
```

### Статический анализ

- Запуск линтеров:
```commandline
make lint
```

- Запуск форматирования кода:
```commandline
make format
```

### Дополнительные команды

- Создание новой ревизии:
```commandline
make revision
```
- Открытие базы данных внутри Docker-контейнера:
```commandline
make open_db
```

- Вывести список всех команд и их описание:
```commandline
make help
```
